<!DOCTYPE html>
<html>

<head>
    <title>Text and Image Processing API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .container {
            margin-top: 20px;
        }

        .result {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }

        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            color: black;
        }

        .tab button:hover {
            background-color: #ddd;
        }

        .tab button.active {
            background-color: #ccc;
        }

        .tabcontent {
            display: none;
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-top: none;
        }

        .image-preview {
            max-width: 100%;
            max-height: 400px;
            margin: 10px 0;
            display: block;
        }

        .image-container {
            margin: 20px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .audio-container {
            margin: 20px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        audio {
            width: 100%;
            margin: 10px 0;
        }
    </style>
</head>

<body>
    <h1>Text and Image Processing API</h1>

    <div class="tab">
        <button class="tablinks" onclick="openTab(event, 'TextTab')" id="defaultOpen">Text Processing</button>
        <button class="tablinks" onclick="openTab(event, 'ImageTab')">Image Processing</button>
        <button class="tablinks" onclick="openTab(event, 'AudioTab')">Audio Processing</button>
    </div>

    <div id="TextTab" class="tabcontent">
        <div class="container">
            <h2>Upload Text File</h2>
            <input type="file" id="textFileInput" accept=".txt">
            <button onclick="uploadText()">Upload</button>
        </div>

        <div class="container">
            <h2>Text Actions</h2>
            <button onclick="showSample()">Show Sample</button>
            <button onclick="preprocessText()">Preprocess</button>
            <button onclick="augmentText()">Augment</button>
        </div>

        <div class="result" id="textResult">
            <p>Text results will appear here...</p>
        </div>
    </div>

    <div id="ImageTab" class="tabcontent">
        <div class="container">
            <h2>Upload Image File</h2>
            <input type="file" id="imageFileInput" accept="image/*">
            <button onclick="uploadImage()">Upload</button>
        </div>

        <div class="container">
            <h2>Image Actions</h2>
            <button onclick="preprocessImage()">Preprocess</button>
            <button onclick="augmentImage()">Augment</button>
        </div>

        <div class="result" id="imageResult">
            <div class="image-container">
                <h3>Original Image:</h3>
                <img id="originalImagePreview" class="image-preview" style="display: none;">
            </div>
            <div class="image-container">
                <h3>Preprocessed Image:</h3>
                <img id="preprocessedImagePreview" class="image-preview" style="display: none;">
            </div>
            <div class="image-container">
                <h3>Augmented Image:</h3>
                <img id="augmentedImagePreview" class="image-preview" style="display: none;">
            </div>
        </div>
    </div>

    <div id="AudioTab" class="tabcontent">
        <div class="container">
            <h2>Upload Audio File</h2>
            <input type="file" id="audioFileInput" accept="audio/*">
            <button onclick="uploadAudio()">Upload</button>
        </div>

        <div class="container">
            <h2>Audio Actions</h2>
            <button onclick="preprocessAudio()">Preprocess</button>
            <button onclick="augmentAudio()">Augment</button>
        </div>

        <div class="result" id="audioResult">
            <div class="audio-container">
                <h3>Original Audio:</h3>
                <audio id="originalAudioPreview" controls style="display: none;"></audio>
            </div>
            <div class="audio-container">
                <h3>Preprocessed Audio:</h3>
                <p id="preprocessInfo" style="display: none;">
                    Applied preprocessing:
                <ul>
                    <li>Converted to mono</li>
                    <li>Resampled to 22050Hz</li>
                    <li>Applied noise reduction</li>
                    <li>Normalized audio</li>
                </ul>
                </p>
                <audio id="preprocessedAudioPreview" controls style="display: none;"></audio>
                <div id="spectrogramContainer" style="display: none;">
                    <h4>MFCC Spectrogram:</h4>
                    <img id="spectrogramPreview" style="width: 100%; max-width: 800px;">
                </div>
            </div>
            <div class="audio-container">
                <h3>Augmented Audio:</h3>
                <p id="augmentInfo" style="display: none;">
                    Applied augmentations:
                <ul>
                    <li>Time stretching (0.8-1.2x)</li>
                    <li>Pitch shifting (±4 semitones)</li>
                    <li>Added background noise</li>
                </ul>
                </p>
                <audio id="augmentedAudioPreview" controls style="display: none;"></audio>
                <div id="augmentedSpectrogramContainer" style="display: none;">
                    <h4>Augmented MFCC Spectrogram:</h4>
                    <img id="augmentedSpectrogramPreview" style="width: 100%; max-width: 800px;">
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab functionality
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // Open Text tab by default
        document.getElementById("defaultOpen").click();

        // Text processing functions
        async function uploadText() {
            const fileInput = document.getElementById('textFileInput');
            const file = fileInput.files[0];
            if (!file) {
                alert('Please select a text file first!');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('/upload/text', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                document.getElementById('textResult').innerHTML = `
                    <h3>Upload Result:</h3>
                    <p>${data.message}</p>
                    <p>Sample: ${data.sample}</p>
                `;
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Image processing functions
        async function uploadImage() {
            const fileInput = document.getElementById('imageFileInput');
            const file = fileInput.files[0];
            if (!file) {
                alert('Please select an image file first!');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('/upload/image', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                // 원본 이미지 표시
                document.getElementById('originalImagePreview').src = `data:image/png;base64,${data.image}`;
                document.getElementById('originalImagePreview').style.display = 'block';

                // 다른 이미지 프리뷰 숨기기
                document.getElementById('preprocessedImagePreview').style.display = 'none';
                document.getElementById('augmentedImagePreview').style.display = 'none';
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function preprocessImage() {
            try {
                const response = await fetch('/preprocess/image', {
                    method: 'POST'
                });
                const data = await response.json();

                // 전처리된 이미지 표시
                document.getElementById('preprocessedImagePreview').src = `data:image/png;base64,${data.image}`;
                document.getElementById('preprocessedImagePreview').style.display = 'block';
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function augmentImage() {
            try {
                const response = await fetch('/augment/image', {
                    method: 'POST'
                });
                const data = await response.json();

                // 증강된 이미지 표시
                document.getElementById('augmentedImagePreview').src = `data:image/png;base64,${data.image}`;
                document.getElementById('augmentedImagePreview').style.display = 'block';
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function showSample() {
            try {
                const response = await fetch('/show-sample');
                const data = await response.json();
                document.getElementById('textResult').innerHTML = `
                    <h3>Sample Text:</h3>
                    <p>${data.sample || data.message}</p>
                `;
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function preprocessText() {
            try {
                const response = await fetch('/preprocess/text', {
                    method: 'POST'
                });
                const data = await response.json();
                document.getElementById('textResult').innerHTML = `
                    <h3>Preprocessed Text:</h3>
                    <p>${data.preprocessed_sample || data.message}</p>
                `;
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function augmentText() {
            try {
                const response = await fetch('/augment/text', {
                    method: 'POST'
                });
                const data = await response.json();
                document.getElementById('textResult').innerHTML = `
                    <h3>Augmented Text:</h3>
                    <p>${data.augmented_sample || data.message}</p>
                `;
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function uploadAudio() {
            const fileInput = document.getElementById('audioFileInput');
            const file = fileInput.files[0];
            if (!file) {
                alert('Please select an audio file first!');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('/upload/audio', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                // 원본 오디오 표시
                document.getElementById('originalAudioPreview').src = `data:audio/wav;base64,${data.audio}`;
                document.getElementById('originalAudioPreview').style.display = 'block';

                // 다른 오디오 프리뷰 숨기기
                document.getElementById('preprocessedAudioPreview').style.display = 'none';
                document.getElementById('augmentedAudioPreview').style.display = 'none';
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function preprocessAudio() {
            try {
                const response = await fetch('/preprocess/audio', {
                    method: 'POST'
                });
                const data = await response.json();

                // Show processed audio
                document.getElementById('preprocessedAudioPreview').src = `data:audio/wav;base64,${data.audio}`;
                document.getElementById('preprocessedAudioPreview').style.display = 'block';

                // Show preprocessing info
                document.getElementById('preprocessInfo').style.display = 'block';

                // Show MFCC spectrogram
                if (data.spectrogram) {
                    document.getElementById('spectrogramPreview').src = `data:image/png;base64,${data.spectrogram}`;
                    document.getElementById('spectrogramContainer').style.display = 'block';
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function augmentAudio() {
            try {
                const response = await fetch('/augment/audio', {
                    method: 'POST'
                });
                const data = await response.json();

                // Show augmented audio
                document.getElementById('augmentedAudioPreview').src = `data:audio/wav;base64,${data.audio}`;
                document.getElementById('augmentedAudioPreview').style.display = 'block';

                // Show augmentation info
                document.getElementById('augmentInfo').style.display = 'block';

                // Show augmented MFCC spectrogram if available
                if (data.spectrogram) {
                    document.getElementById('augmentedSpectrogramPreview').src = `data:image/png;base64,${data.spectrogram}`;
                    document.getElementById('augmentedSpectrogramContainer').style.display = 'block';
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }
    </script>
</body>

</html>